# 错误码完整列表

## 1. 概述

系统采用统一的错误码规范，所有 API 返回的 `code` 字段均遵循本文档定义。

---

## 2. 错误码概览

| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| 0 | 成功 | 无需处理 |
| 1 | 参数不合法 | 检查请求参数格式和必填项 |
| 2 | 该 Username 已存在 | 更换用户名 |
| 3 | 用户已删除 | 联系管理员恢复账户 |
| 4 | 用户不存在 | 检查用户ID是否正确 |
| 5 | 密码错误 | 重新输入正确密码 |
| 6 | 用户未登录 | 进行登录操作 |
| 7 | 课程已满 | 选择其他课程 |
| 8 | 课程已绑定过 | 检查课程绑定状态 |
| 9 | 课程未绑定过 | 先绑定课程再操作 |
| 10 | 没有操作权限 | 检查操作权限 |
| 12 | 课程不存在 | 检查课程ID |
| 15 | 重复请求 | 勿重复提交 |
| 255 | 未知错误 | 联系技术支持 |

---

## 3. 详细说明

### 3.1 成功

| 错误码 | 0 |
|--------|---|
| message | success |
| 说明 | 请求成功处理 |

**响应示例**:
```json
{
  "code": 0,
  "message": "success"
}
```

---

### 3.2 参数不合法

| 错误码 | 1 |
|--------|---|
| message | 参数不合法 |
| 说明 | 请求参数缺失、格式错误或值不合法 |
| 常见原因 | 必填参数缺失、参数类型错误、参数值越界 |

**处理建议**:
- 检查请求参数是否完整
- 检查参数类型是否正确 (如需要整数但传了字符串)
- 检查参数值是否在有效范围内

**响应示例**:
```json
{
  "code": 1,
  "message": "参数不合法"
}
```

---

### 3.3 用户名已存在

| 错误码 | 2 |
|--------|---|
| message | 该 Username 已存在 |
| 说明 | 创建用户时用户名与现有用户重复 |

**处理建议**: 更换用户名

**响应示例**:
```json
{
  "code": 2,
  "message": "该 Username 已存在"
}
```

---

### 3.4 用户已删除

| 错误码 | 3 |
|--------|---|
| message | 用户已删除 |
| 说明 | 用户账户已被软删除 |

**处理建议**: 联系管理员恢复账户

---

### 3.5 用户不存在

| 错误码 | 4 |
|--------|---|
| message | 用户不存在 |
| 说明 | 指定的用户ID不存在 |

**处理建议**: 检查用户ID是否正确

---

### 3.6 密码错误

| 错误码 | 5 |
|--------|---|
| message | 密码错误 |
| 说明 | 输入的密码与账户密码不匹配 |

**处理建议**: 重新输入正确密码

---

### 3.7 用户未登录

| 错误码 | 6 |
|--------|---|
| message | 用户未登录 |
| 说明 | Session 不存在或已过期 |

**处理建议**: 重新登录获取新的 Session

---

### 3.8 课程已满

| 错误码 | 7 |
|--------|---|
| message | 课程已满 |
| 说明 | 课程可选人数已达上限 |

**处理建议**: 选择其他课程

---

### 3.9 课程已绑定过

| 错误码 | 8 |
|--------|---|
| message | 课程已绑定过 |
| 说明 | 课程已被其他教师绑定 |

**处理建议**:
- 检查是否绑定到了错误的课程
- 先解绑再重新绑定

---

### 3.10 课程未绑定过

| 错误码 | 9 |
|--------|---|
| message | 课程未绑定过 |
| 说明 | 课程未绑定到任何教师 |

**处理建议**: 先绑定课程再进行解绑操作

---

### 3.11 没有操作权限

| 错误码 | 10 |
|--------|-----|
| message | 没有操作权限 |
| 说明 | 当前用户无权执行该操作 |

**常见场景**:
- 非管理员尝试执行管理员操作
- 非绑定该课程的教师尝试解绑
- 学生尝试访问教师接口

**处理建议**: 检查用户角色和权限

---

### 3.12 课程不存在

| 错误码 | 12 |
|--------|-----|
| message | 课程不存在 |
| 说明 | 指定的课程ID不存在 |

**处理建议**: 检查课程ID是否正确

---

### 3.13 重复请求

| 错误码 | 15 |
|--------|-----|
| message | 重复请求 |
| 说明 | 重复提交相同的请求 |

**常见场景**:
- 学生重复选同一门课程
- 重复提交相同的创建请求

**处理建议**: 检查是否已执行过该操作

---

### 3.14 未知错误

| 错误码 | 255 |
|--------|------|
| message | 未知错误 |
| 说明 | 未预期的错误情况 |

**处理建议**:
- 检查服务端日志
- 联系技术支持

---

## 4. HTTP 状态码

部分错误会返回对应的 HTTP 状态码：

| HTTP 状态码 | 含义 | 使用场景 |
|-------------|------|----------|
| 200 | OK | 请求成功 (业务错误码在 body 中) |
| 401 | Unauthorized | 未授权 (Session 无效) |
| 403 | Forbidden | 禁止访问 (权限不足) |

**401 响应示例**:
```json
{
  "code": 401,
  "message": "用户未登录"
}
```

**403 响应示例**:
```json
{
  "code": 403,
  "message": "需要管理员权限"
}
```

---

## 5. 错误处理示例

### 5.1 Go 语言错误处理

```go
// 统一错误处理
if err != nil {
    if e, ok := err.(errcode.ErrCode); ok {
        c.JSON(200, response.Fail(e))
    } else {
        c.JSON(200, response.Fail(errcode.UnknownError))
    }
    return
}
```

### 5.2 前端错误处理

```javascript
// axios 响应拦截器
axios.interceptors.response.use(
  response => {
    if (response.data.code === 0) {
      return response.data.data;
    } else {
      // 显示错误提示
      Toast.fail(response.data.message);
      return Promise.reject(response.data);
    }
  },
  error => {
    // HTTP 状态码错误
    if (error.response) {
      switch (error.response.status) {
        case 401:
          // 跳转登录
          router.push('/login');
          break;
        case 403:
          Toast.fail('没有操作权限');
          break;
      }
    }
    return Promise.reject(error);
  }
);
```

---

## 6. 错误码定义位置

**文件路径**: [errcode.go](../internal/pkg/errcode/errcode.go)

```go
var (
    OK                 = ErrCode{Code: 0, Msg: "success"}
    ParamInvalid       = ErrCode{Code: 1, Msg: "参数不合法"}
    UserHasExisted     = ErrCode{Code: 2, Msg: "该 Username 已存在"}
    UserHasDeleted     = ErrCode{Code: 3, Msg: "用户已删除"}
    UserNotExisted     = ErrCode{Code: 4, Msg: "用户不存在"}
    WrongPassword      = ErrCode{Code: 5, Msg: "密码错误"}
    LoginRequired      = ErrCode{Code: 6, Msg: "用户未登录"}
    CourseNotAvailable = ErrCode{Code: 7, Msg: "课程已满"}
    CourseHasBound     = ErrCode{Code: 8, Msg: "课程已绑定过"}
    CourseNotBind      = ErrCode{Code: 9, Msg: "课程未绑定过"}
    PermDenied         = ErrCode{Code: 10, Msg: "没有操作权限"}
    CourseNotExisted   = ErrCode{Code: 12, Msg: "课程不存在"}
    RepeatRequest      = ErrCode{Code: 15, Msg: "重复请求"}
    UnknownError       = ErrCode{Code: 255, Msg: "未知错误"}
)
```

---

## 7. 扩展错误码

如需添加新的错误码，建议按以下规则：

| 错误码范围 | 用途 |
|------------|------|
| 0 | 成功 |
| 1-99 | 通用错误 (参数、认证等) |
| 100-199 | 用户相关错误 |
| 200-299 | 课程相关错误 |
| 255 | 未知错误 |

**示例**:
```go
// 用户相关错误 (100-199)
UserDisabled = ErrCode{Code: 101, Msg: "用户已被禁用"}

// 课程相关错误 (200-299)
CourseDisabled = ErrCode{Code: 201, Msg: "课程已停选"}
```
